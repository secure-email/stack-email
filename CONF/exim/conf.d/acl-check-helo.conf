# acl-check-helo.conf

#IP literal HELO
deny message     = HELO command rejected: HELO is IP only (See RFC2821 4.1.3)
     log_message = HELO ($sender_helo_name) is IP only (See RFC2821 4.1.3)
     condition   = ${if isip{$sender_helo_name}}
     set acl_m_dbupdate = $sender_helo_name

#Invalid HELO (no dot)
deny message     = HELO command rejected: HELO is not an FQDN (contains no dot) (See RFC2821 4.1.1.1)
     log_message = HELO ($sender_helo_name) is no FQDN (contains no dot)
     condition   = ${if match{$sender_helo_name}{\N^\[\N}{no}{yes}}
     condition   = ${if match{$sender_helo_name}{\N\.\N}{no}{yes}}

#Invalid HELO (double dot)
deny message     = HELO command rejected: HELO is not an FQDN (contains double dot) (See RFC2821 4.1.1.1)
     log_message = HELO ($sender_helo_name) is no FQDN (contains double dot)
     condition   = ${if match{$sender_helo_name}{\N\.\.\N}{yes}{no}}

#Invalid HELO (ends in dot)
deny message     = HELO command rejected: HELO is not an FQDN (ends in dot) (See RFC2821 4.1.1.1)
     log_message = HELO ($sender_helo_name) is no FQDN (ends in dot)
     condition   = ${if match{$sender_helo_name}{\N\.$\N}}

#Funny fellas using our name
deny message     = HELO command rejected: Impersonating me [$primary_hostname].
     log_message = HELO ($sender_helo_name) impersonating [$primary_hostname]
     condition   = ${if match{$sender_helo_name}{$primary_hostname}{yes}{no}}

#Using our addess as HELO
deny message     = Client host rejected: You are trying to use my address [$interface_address]
     log_message = HELO ($sender_helo_name) uses my address ($interface_address)
     condition   = ${if eq{[$interface_address]}{$sender_helo_name}}

#No HELO at all
deny message     = Client host rejected: no HELO
     log_message = no HELO ($sender_helo_name)
     condition   = ${if !def:sender_helo_name}

accept
